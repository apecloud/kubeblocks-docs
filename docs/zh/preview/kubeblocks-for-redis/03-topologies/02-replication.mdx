---
description: 了解如何使用KubeBlocks部署Redis复制集群。本指南涵盖配置、验证、故障转移测试及超时设置等内容。
keywords:
- KubeBlocks
- Redis
- Kubernetes
- High Availability
sidebar_label: Redis 复制集群
sidebar_position: 1
title: 使用KubeBlocks部署Redis复制集群
---
# 使用 KubeBlocks 部署 Redis 复制集群

Redis 复制（Replication）集群由一个处理写入的主节点（primary/master）和一个或多个从节点（replica/slave）组成，从节点通过复制主节点数据来实现读取扩展和故障转移。

**适用场景**
- 读密集型应用（如分析类工作负载）
- 需要高可用性的场景（配合 Redis Sentinel 实现自动故障转移）

## 先决条件

import Prerequisites from '../_tpl/_prerequisites.mdx'

<Prerequisites />

## 部署 Redis 复制集群

```yaml
apiVersion: apps.kubeblocks.io/v1
kind: Cluster
metadata:
  name: redis-replication
  namespace: demo
spec:
  terminationPolicy: Delete
  clusterDef: redis
  topology: replication
  componentSpecs:
    - name: redis
      serviceVersion: "7.2.4"
      disableExporter: false
      replicas: 2
      resources:
        limits:
          cpu: '0.5'
          memory: 0.5Gi
        requests:
          cpu: '0.5'
          memory: 0.5Gi
      volumeClaimTemplates:
        - name: data
          spec:
            storageClassName: ""
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 20Gi
    - name: redis-sentinel
      replicas: 3
      resources:
        limits:
          cpu: '0.5'
          memory: 0.5Gi
        requests:
          cpu: '0.5'
          memory: 0.5Gi
      volumeClaimTemplates:
        - name: data
          spec:
            storageClassName: ""
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 20Gi
```

**关键配置说明**：
- `clusterDef: redis`：指定集群使用的 ClusterDefinition CR
- `topology: replication`：配置集群使用复制拓扑结构
- `componentSpecs`：定义集群中的组件：
  - 'redis' 组件：
    - `serviceVersion: 7.2.4`：指定要部署的 Redis 服务版本
  - 'redis-sentinel' 组件：
    - Redis Sentinel 是 Redis 的高可用性解决方案，建议部署 3 个副本以确保高可用性

## 验证部署

### 检查集群状态
集群部署完成后，检查其状态：
```bash
kubectl get cluster redis-replication  -n demo -w
```
预期输出：
```bash
NAME                CLUSTER-DEFINITION   TERMINATION-POLICY   STATUS    AGE
redis-replication   redis                Delete               Running   66s
```

### 验证组件和 Pod 状态
```bash
kubectl get component redis-replication-redis -n demo
```
预期输出：
```bash
NAME                      DEFINITION              SERVICE-VERSION   STATUS    AGE
redis-replication-redis   redis-7-1.0.0           7.2.4             Running   90s
```

检查 Pod 及其角色

```bash
kubectl get pods -l app.kubernetes.io/instance=redis-replication -L  kubeblocks.io/role -n demo
```

预期输出：
```bash
NAME                                 READY   STATUS    RESTARTS   AGE     ROLE
redis-replication-redis-0            3/3     Running   0          3m38s   primary
redis-replication-redis-1            3/3     Running   0          3m16s   secondary
redis-replication-redis-sentinel-0   2/2     Running   0          4m35s
redis-replication-redis-sentinel-1   2/2     Running   0          4m17s
redis-replication-redis-sentinel-2   2/2     Running   0          3m59s
```

## 清理资源
删除本教程中创建的所有资源：

```bash
kubectl delete cluster redis-replication -n demo
kubectl delete ns demo
```