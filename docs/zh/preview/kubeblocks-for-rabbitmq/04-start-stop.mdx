---
title: 停止/启动
description: How to Stop/Start RabbitMQ on KubeBlocks
keywords: [RabbitMQ, vector database, control plane]
sidebar_position: 4
sidebar_label: Stop/Start RabbitMQ with KubeBlocks
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';


## 停止/启动集群

您可以停止/启动集群以释放计算资源。当集群停止时，其计算资源将被释放，也就是说 Kubernetes 的 Pod 将被释放，但其存储资源仍将被保留。您也可以重新启动该集群，使其恢复到停止集群前的状态。

### 停止集群

1. 配置集群名称，并执行以下命令来停止该集群。

   <Tabs>

   <TabItem value="OpsRequest" label="OpsRequest" default>

   ```bash
   kubectl apply -f - <<EOF
   apiVersion: apps.kubeblocks.io/v1alpha1
   kind: OpsRequest
   metadata:
     name: mycluster-stop
     namespace: demo
   spec:
     clusterName: mycluster
     type: Stop
   EOF
   ```

   </TabItem>

   <TabItem value="修改集群 YAML 文件" label="修改集群 YAML 文件">

   将 replicas 的值修改为 0，删除 pod。

   ```yaml
   apiVersion: apps.kubeblocks.io/v1alpha1
   kind: Cluster
   metadata:
     name: mycluster
     namespace: demo
   spec:
     terminationPolicy: Delete
     affinity:
       podAntiAffinity: Preferred
       topologyKeys:
         - kubernetes.io/hostname
     componentSpecs:
       - name: rabbitmq
         componentDef: rabbitmq
         serviceVersion: 3.13.2
         replicas: 0
         serviceAccountName: kb-mycluster
         resources:
           limits:
             cpu: "0.5"
             memory: "0.5Gi"
           requests:
             cpu: "0.5"
             memory: "0.5Gi"
         volumeClaimTemplates:
           - name: data
             spec:
               accessModes:
                 - ReadWriteOnce
               resources:
                 requests:
                   storage: 20Gi
         services:
   ```

   </TabItem>

   </Tabs>

2. 查看集群状态，确认集群是否已停止。

   ```bash
   kubectl get cluster mycluster -n demo
   ```

### 启动集群

1. 配置集群名称，并执行以下命令来启动该集群。

   <Tabs>

   <TabItem value="OpsRequest" label="OpsRequest" default>

   ```bash
   kubectl apply -f - <<EOF
   apiVersion: apps.kubeblocks.io/v1alpha1
   kind: OpsRequest
   metadata:
     name: mycluster-start
     namespace: demo
   spec:
     clusterName: mycluster
     type: Start
   EOF
   ```

   </TabItem>

   <TabItem value="修改集群 YAML 文件" label="修改集群 YAML 文件">

   将 replicas 数值修改为初始值，启动集群。

   ```yaml
   apiVersion: apps.kubeblocks.io/v1alpha1
   kind: Cluster
   metadata:
     name: mycluster
     namespace: demo
   spec:
     terminationPolicy: Delete
     affinity:
       podAntiAffinity: Preferred
       topologyKeys:
         - kubernetes.io/hostname
     componentSpecs:
       - name: rabbitmq
         componentDef: rabbitmq
         serviceVersion: 3.13.2
         replicas: 3
         serviceAccountName: kb-mycluster
         resources:
           limits:
             cpu: "0.5"
             memory: "0.5Gi"
           requests:
             cpu: "0.5"
             memory: "0.5Gi"
         volumeClaimTemplates:
           - name: data
             spec:
               accessModes:
                 - ReadWriteOnce
               resources:
                 requests:
                   storage: 20Gi
         services:
   ```

   </TabItem>

   </Tabs>

2. 查看集群状态，确认集群是否已再次运行。

   ```bash
   kubectl get cluster mycluster -n demo
   ```
