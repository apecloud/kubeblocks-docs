---
description: 了解如何在KubeBlocks中部署MySQL集群，并通过为root用户设置自定义密码生成策略来增强安全性。
keywords:
- MySQL
- KubeBlocks
- Password Policy
- Kubernetes
- Security
sidebar_label: 自定义密码策略
sidebar_position: 2
title: 在KubeBlocks上部署支持自定义密码生成策略的MySQL集群
---
# 在 KubeBlocks 上创建采用自定义密码生成策略的 MySQL 集群
本指南将说明如何在 KubeBlocks 中部署 MySQL 集群，并为 root 用户配置自定义密码生成策略。通过定义特定密码规则，您可以确保集群使用强安全凭证。



## 前提条件

在继续之前，请确保满足以下要求：
- 环境准备：
  - 已启动并运行一个 Kubernetes 集群。
  - 已配置 kubectl CLI 工具以与集群通信。
  - 已安装 [KubeBlocks CLI](../../user_docs/references/install-kbcli) 和 [KubeBlocks Operator](../../user_docs/overview/install-kubeblocks)。请按照此处提供的安装说明进行操作。
- 命名空间准备：为保持资源隔离，请为本教程创建一个专用命名空间：

```bash
kubectl create ns demo
namespace/demo created
```




## 部署 MySQL 半同步集群

KubeBlocks 采用声明式方法管理 MySQL 集群。以下是一个配置示例，用于部署包含 2 个节点（1 个主节点，1 个副本节点）的半同步模式 MySQL 集群，并设置符合特定模式的 root 密码。



```yaml
kubectl apply -f - <<EOF
apiVersion: apps.kubeblocks.io/v1
kind: Cluster
metadata:
  name: example-mysql-cluster
  namespace: demo
spec:
  clusterDef: mysql
  topology: semisync
  terminationPolicy: Delete
  componentSpecs:
    - name: mysql
      serviceVersion: 8.0.35
      replicas: 2
      systemAccounts:
        - name: root
          passwordConfig:
            length: 20           # Password length: 20 characters
            numDigits: 4         # At least 4 digits
            numSymbols: 4        # At least 4 symbols
            letterCase: MixedCases # Uppercase and lowercase letters
      resources:
        limits:
          cpu: '0.5'
          memory: 0.5Gi
        requests:
          cpu: '0.5'
          memory: 0.5Gi
      volumeClaimTemplates:
        - name: data
          spec:
            storageClassName: ""
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 20Gi
EOF
```

**密码策略的关键特性：**
- 长度：20个字符。
- 组成要求：
  - 至少包含4位数字。
  - 至少包含4个符号。
  - 混合大小写字母。

这确保了生成的密码强度高且安全。



## 验证部署

集群部署完成后，监控其状态：

```bash
kubectl get cluster example-mysql-cluster -n demo -w
NAME                                    CLUSTER-DEFINITION   TERMINATION-POLICY   STATUS     AGE
example-mysql-cluster   mysql                Delete               Creating   10s
example-mysql-cluster   mysql                Delete               Running    1m
```

等待直到 STATUS 变为 Running。

## 获取密码

KubeBlocks 会自动创建一个包含 MySQL root 凭据的 Secret。通过以下命令获取凭据：

```bash
kubectl get secrets -n demo example-mysql-cluster-mysql-account-root -o jsonpath='{.data.password}' | base64 -d
```

预期输出：

```bash
v@DI5PC7n*#3hE#HjRV0
```

该密码具有以下特征：
- 长度：20个字符。
- 组成：
  - 4位数字。
  - 4个符号。
  - 12个字母（大小写混合）。

此密码符合配置中定义的自定义策略。

## 连接到 MySQL 集群

要连接到集群的主节点，请使用 MySQL 客户端并输入自定义密码：

```bash
kubectl exec -it -n demo example-mysql-cluster-mysql-0 -c mysql -- mysql -h example-mysql-cluster-mysql.demo.svc.cluster.local -uroot -pv@DI5PC7n*#3hE#HjRV0
```




## 清理
要删除所有已创建的资源，请连同其命名空间一起删除 MySQL 集群：

```bash
kubectl delete cluster example-mysql-cluster -n demo
kubectl delete ns demo
```




## 摘要
在本教程中，您完成了以下操作：
- 使用 KubeBlocks 配置并部署了一个采用自定义密码生成策略的 MySQL 集群。
- 验证了部署并获取自动生成的 root 密码。
- 使用安全自动生成的密码连接到 MySQL 集群。
这种方法简化了密码管理，同时为数据库部署保持了高标准的安全性。

